<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gec.auction.mapper.AuctionCustomMapper" >
 <resultMap id="auctionAndRecordAndUserResultMap" type="com.gec.auction.pojo.Auction" >
	    <id column="auctionId" property="auctionid" jdbcType="INTEGER" />
	    <result column="auctionName" property="auctionname" jdbcType="VARCHAR" />
	    <result column="auctionStartPrice" property="auctionstartprice" jdbcType="DECIMAL" />
	    <result column="auctionUpset" property="auctionupset" jdbcType="DECIMAL" />
	    <result column="auctionStartTime" property="auctionstarttime" jdbcType="TIMESTAMP" />
	    <result column="auctionEndTime" property="auctionendtime" jdbcType="TIMESTAMP" />
	    <result column="auctionPic" property="auctionpic" jdbcType="VARCHAR" />
	    <result column="auctionPicType" property="auctionpictype" jdbcType="VARCHAR" />
	    <result column="auctionDesc" property="auctiondesc" jdbcType="VARCHAR" />
	    <collection property="auctionRecordList" ofType="com.gec.auction.pojo.AuctionRecord">
		    <id column="record_id" property="id" jdbcType="INTEGER" />
		    <result column="record_user_id" property="userid" jdbcType="INTEGER" />
		    <result column="record_auction_id" property="auctionid" jdbcType="INTEGER" />
		    <result column="auctionTime" property="auctiontime" jdbcType="TIMESTAMP" />
		    <result column="auctionPrice" property="auctionprice" jdbcType="DECIMAL" />
		    <association property="auctionUser" javaType="com.gec.auction.pojo.AuctionUser">
			    <id column="record_user_id" property="userid" jdbcType="INTEGER" />
	            <result column="userName" property="username" jdbcType="VARCHAR" />
		    </association>
	    </collection>
	    
 </resultMap>
 <select id="findAuctionAndRecordAndUserById" parameterType="int" resultMap="auctionAndRecordAndUserResultMap" >
	 	SELECT auction.*,
	           auctionrecord.id record_id,
	           auctionrecord.userId record_user_id,
			   auctionrecord.auctionId record_auction_id,
			   auctionrecord.auctiontime,
			   auctionrecord.auctionprice,
			   auctionuser.username
		FROM auction 
		LEFT OUTER JOIN auctionrecord ON auction.auctionId=auctionrecord.auctionId 
		LEFT OUTER JOIN auctionuser ON auctionuser.userId=auctionrecord.userId 
		WHERE auction.auctionId=#{value}
		ORDER BY  auctionrecord.auctionprice DESC
 </select>
 <!-- 查看拍卖商品的 -->
 <select id="findEndAuction" resultType="com.gec.auction.pojo.AuctionCustom">
 	SELECT auction.auctionName,
		auction.auctionStartPrice,
		auction.auctionStartTime,
		auction.auctionEndTime,
		auctionrecord.auctionPrice,
		auctionuser.userName 
	FROM auction,auctionrecord,auctionuser
	WHERE   auction.auctionId = auctionrecord.auctionId AND
			auctionuser.userId = auctionrecord.userId AND 
			auctionrecord.auctionTime  <![CDATA[  < ]]> NOW() AND 
			auctionrecord.auctionPrice = 
	(SELECT MAX(r.auctionPrice) FROM auctionrecord r WHERE r.auctionId=auction.auctionId)
 </select>
 <!-- 查看拍卖中的商品 -->
 <select id="findBuyingAuction" resultMap="auctionAndRecordAndUserResultMap">
		 SELECT auction.*,
			           auctionrecord.id record_id,
			           auctionrecord.userId record_user_id,
					   auctionrecord.auctionId record_auction_id,
					   auctionrecord.auctiontime,
					   auctionrecord.auctionprice,
					   auctionuser.username
		FROM auction,auctionrecord,auctionuser
		WHERE   auction.auctionId = auctionrecord.auctionId AND
				auctionuser.userId = auctionrecord.userId AND 
				auctionrecord.auctionTime  <![CDATA[  > ]]> NOW()
 </select>
</mapper>